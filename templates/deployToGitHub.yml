steps:
- checkout: github_pages
  path: "./target"
  
- task: DeleteFiles@1
  inputs:
    SourceFolder: '$(Agent.BuildDirectory)/target'
    Contents: '!(*.git)'

- task: CopyFiles@2
  inputs:
    SourceFolder: '$(Agent.BuildDirectory)/build-output'
    Contents: '**'
    TargetFolder: '$(Agent.BuildDirectory)/target'

- powershell: |
    Write-Host "Adding artifact directory: $(Agent.BuildDirectory)/target"
    git add "$(Agent.BuildDirectory)/target"
    Write-Host "Set user.name to Pipeline"
    git config user.name "Pipeline"
    Write-Host "Commit changes"
    git commit -m "Push build to release branch"
    Write-Host "Push the commit to origin release"
    git push --set-upstream origin release
